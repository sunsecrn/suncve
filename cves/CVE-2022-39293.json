{"cveId": "CVE-2022-39293", "cwe": ["CWE-191", "CWE-191"], "cvss": [{"baseScore": "8.6", "version": "3.1", "Attack Vector": "None", "Attack Complexity": "Low", "Privileges Required": "None", "User Interaction": "None", "Scope": "Unchaged", "Confidentiality Impact": "Low", "Integrity Impact": "Low", "Availability Impact": "High"}], "references": ["https://github.com/azure-rtos/usbx/releases/tag/v6.1.12_rel", "https://github.com/azure-rtos/usbx/security/advisories/GHSA-gg76-h537-xq48"], "description": ["Azure RTOS USBX is a high-performance USB host, device, and on-the-go (OTG) embedded stack, that is fully integrated with Azure RTOS ThreadX. The case is, in [_ux_host_class_pima_read](https://github.com/azure-rtos/usbx/blob/master/common/usbx_host_classes/src/ux_host_class_pima_read.c), there is data length from device response, returned in the very first packet, and read by [L165 code](https://github.com/azure-rtos/usbx/blob/082fd9db09a3669eca3358f10b8837a5c1635c0b/common/usbx_host_classes/src/ux_host_class_pima_read.c#L165), as header_length. Then in [L178 code](https://github.com/azure-rtos/usbx/blob/082fd9db09a3669eca3358f10b8837a5c1635c0b/common/usbx_host_classes/src/ux_host_class_pima_read.c#L178), there is a “if” branch, which check the expression of “(header_length - UX_HOST_CLASS_PIMA_DATA_HEADER_SIZE) > data_length” where if header_length is smaller than UX_HOST_CLASS_PIMA_DATA_HEADER_SIZE, calculation could overflow and then [L182 code](https://github.com/azure-rtos/usbx/blob/082fd9db09a3669eca3358f10b8837a5c1635c0b/common/usbx_host_classes/src/ux_host_class_pima_read.c#L182) the calculation of data_length is also overflow, this way the later [while loop start from L192](https://github.com/azure-rtos/usbx/blob/082fd9db09a3669eca3358f10b8837a5c1635c0b/common/usbx_host_classes/src/ux_host_class_pima_read.c#L192) can move data_pointer to unexpected address and cause write buffer overflow. The fix has been included in USBX release [6.1.12](https://github.com/azure-rtos/usbx/releases/tag/v6.1.12_rel). The following can be used as a workaround: Add check of `header_length`: 1. It must be greater than `UX_HOST_CLASS_PIMA_DATA_HEADER_SIZE`. 1. It should be greater or equal to the current returned data length (`transfer_request -> ux_transfer_request_actual_length`)."], "published": "2022-10-13T19:15:09.750", "state": "PUBLIC", "vendorName": ["azure-rtos"], "productName": ["usbx"], "github": {"advisories": ["https://github.com/azure-rtos/usbx/security/advisories/GHSA-gg76-h537-xq48"], "commits": [], "pocAdvisorie": {}, "repo": "https://github.com/azure-rtos/usbx/", "info": {"exist": true, "topics": ["eclipse-threadx", "embedded", "iot", "mcu", "microcontroller", "rtos", "usb", "usb-hid", "usb-host"], "langs": {"C": 21768724, "CMake": 124455, "Shell": 5999}, "avatar": "https://avatars.githubusercontent.com/u/156018450?v=4", "stargazers": 180, "language": "C"}}, "pocList": []}